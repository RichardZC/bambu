@model Hra.Domain.Entity.Grupo

<h4>Grupo</h4>
<hr />
<div class="row">
    <div class="col-12">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="GrupoId" />
            <div class="row">
                <div class="col-6 col-sm-6 col-md-6">
                    <label asp-for="Denominacion" class="form-label"></label>
                    <input asp-for="Denominacion" class="form-control" />
                    <span asp-validation-for="Denominacion" class="text-danger"></span>
                </div>

                <div class="col-6 col-sm-6 col-md-6">
                    <label class="form-label">Fecha Inicio</label>
                    <input name="FechaInicio" class="form-control input-mask" value="@Model.FechaInicio" data-inputmask="'alias': 'datetime'" data-inputmask-inputformat="dd/mm/yyyy" />
                </div>

                <div class="row mt-4">
                    <div class="col-sm-6">
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="mdi mdi-arrow-left me-1"></i> Lista de Clientes
                        </a>
                    </div>
                    <div class="col-sm-6">
                        <div class="text-sm-end mt-2 mt-sm-0">
                            <button id="btnGuardar" type="submit" class="btn btn-primary">
                                <i class="mdi mdi-content-save me-1"></i> Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
@if (Model.GrupoId > 0)
{
    <h4 class="mt-5">Miembros</h4>
    <hr />
    <div class="row">
        <div class="col-12">
            <form asp-action="AgregarMiembro" method="post">
                <div class="row">
                    <input type="hidden" name="pGrupoId" value="@Model.GrupoId" />
                    <input type="hidden" id="pPaterno" name="pPaterno" />
                    <input type="hidden" id="pMaterno" name="pMaterno" />
                    <input type="hidden" id="pNombres" name="pNombres" />

                    <div class="col-sm-3 col-md-2">
                        <label class="form-label">Dni</label>
                        <input id="txtDni" name="pDni" class="form-control input-mask" aria-describedby="btnReniec" required data-inputmask="'mask': '9', 'repeat': 8, 'greedy' : false" />
                    </div>
                    <div class="col-sm-1 col-md-1 ">
                        <button class="btn btn-secondary mt-4 " type="button" id="btnReniec">
                            <i class="bx bx-user-plus font-size-16 align-middle"></i>
                        </button>
                    </div>
                    <div class="col-sm-6 col-md-6">
                        <label class="form-label">Persona</label>
                        <input id="NombreCompleto" class="form-control" required readonly />
                    </div>

                    <div class="col-sm-3">
                        <div class="text-sm-end mt-3">
                            <button id="btnGuardarMiembro" type="submit" class="btn">
                                <i class="mdi mdi-content-save me-1"></i> Agregar
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-12">
            <table class="table table-hover table-bordered  mb-0">
                <thead class="table-light">
                    <tr>
                        <th>DNI</th>
                        <th>Nombre Completo</th>
                        <th>Email</th>
                        <th>Celular</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Cliente)
                    {
                        <tr>
                            <td>
                                @item.Persona.NumeroDocumento
                            </td>
                            <td>
                                @item.Persona.NombreCompleto
                            </td>
                            <td>
                                @item.Persona.Email
                            </td>
                            <td>
                                @item.Persona.Celular
                            </td>
                            <td>
                                <a type="button" href="@Url.Action("Editar","Cliente", new { id=item.PersonaId  })" class="btn btn-primary btn-sm">Editar</a>
                                <a type="button" href="@Url.Action("EliminarMiembro","Grupo", new {pGrupoId=Model.GrupoId,  pPersonaId=item.PersonaId  })" class="btn btn-primary btn-sm">Eliminar</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @section scripts{
<script>
    $(function(){
        $("#btnGuardarMiembro").click(function(e){

            if($('#NombreCompleto').val().length==0){
                toastr.error('Requiere buscar a la persona', 'Validación');
                return false;
            }
            return true;
        });
        $("#btnReniec").click(function() {
            $.ajax({
                type: 'GET',
                url: "https://apiperu.dev/api/dni/" + $("#txtDni").val(),
                data: {},
                headers: { 'Authorization': 'Bearer @ViewBag.TokenApiPeru' },
                success: function(ret) {
                    if (ret.success) {
                        $("#NombreCompleto").val(ret.data.apellido_paterno + ' ' + ret.data.apellido_materno + ' ' + ret.data.nombres);
                        $("#pNombres").val(ret.data.nombres);
                        $("#pPaterno").val(ret.data.apellido_paterno);
                        $("#pMaterno").val(ret.data.apellido_materno);
                    } else {
                        toastr.error('DNI NO ENCONTRADO EN RENIEC.', 'Validación!');
                    }
                }
            });
        });
    });
</script>
    }
}



